{"version":3,"file":"rescripted-server.js","mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACjGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC3JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACxGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACzHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACrIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://overte-dixit/./rescripted/source/board-renderer.ts","webpack://overte-dixit/./rescripted/source/constants.ts","webpack://overte-dixit/./rescripted/source/game/api-builder.ts","webpack://overte-dixit/./rescripted/source/game/board.ts","webpack://overte-dixit/./rescripted/source/game/editor.ts","webpack://overte-dixit/./rescripted/source/game/run-in-context.ts","webpack://overte-dixit/./rescripted/source/game/runner.ts","webpack://overte-dixit/./rescripted/source/game/server-store.ts","webpack://overte-dixit/./rescripted/source/game/shot-manager.ts","webpack://overte-dixit/./rescripted/source/levels/level-00.ts","webpack://overte-dixit/./rescripted/source/levels/level-01.ts","webpack://overte-dixit/./rescripted/source/levels/level-02.ts","webpack://overte-dixit/./rescripted/source/levels/level-03.ts","webpack://overte-dixit/./rescripted/source/levels/level-04.ts","webpack://overte-dixit/./rescripted/source/levels/level-05.ts","webpack://overte-dixit/./rescripted/source/levels/level-06.ts","webpack://overte-dixit/./rescripted/source/levels/level-07.ts","webpack://overte-dixit/./rescripted/source/levels/level-08.ts","webpack://overte-dixit/./rescripted/source/levels/level-09.ts","webpack://overte-dixit/./rescripted/source/levels/level-10.ts","webpack://overte-dixit/./rescripted/source/levels/level-base.ts","webpack://overte-dixit/./rescripted/source/utils/array-utils.ts","webpack://overte-dixit/./rescripted/source/utils/maze.ts","webpack://overte-dixit/webpack/bootstrap","webpack://overte-dixit/./rescripted/source/rescripted-server.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BoardRenderer = void 0;\nvar LAYERS_COUNT = 6;\nvar COLOR_TO_LAYER = {\n    BASE: 0,\n    R: 1,\n    G: 2,\n    B: 3,\n    Y: 4,\n    W: 5\n};\nvar BoardRenderer = /** @class */ (function () {\n    function BoardRenderer(entityId, ids, props) {\n        this.boards = {};\n        this.layers = [];\n        this.entityId = entityId;\n        for (var i = 0; i < ids.length; i++) {\n            var prop = props[i];\n            if (prop.parentID !== this.entityId) {\n                continue;\n            }\n            switch (prop.name) {\n                case 'Text.Rescripted.Board.Base':\n                    this.boards[COLOR_TO_LAYER.BASE] = ids[i];\n                    break;\n                case 'Text.Rescripted.Board.R':\n                    this.boards[COLOR_TO_LAYER.R] = ids[i];\n                    break;\n                case 'Text.Rescripted.Board.G':\n                    this.boards[COLOR_TO_LAYER.G] = ids[i];\n                    break;\n                case 'Text.Rescripted.Board.B':\n                    this.boards[COLOR_TO_LAYER.B] = ids[i];\n                    break;\n                case 'Text.Rescripted.Board.Y':\n                    this.boards[COLOR_TO_LAYER.Y] = ids[i];\n                    break;\n                case 'Text.Rescripted.Board.W':\n                    this.boards[COLOR_TO_LAYER.W] = ids[i];\n                    break;\n            }\n        }\n    }\n    BoardRenderer.prototype.render = function (state) {\n        var lines;\n        var layers = this.splitColors(state);\n        for (var i = 0; i < layers.length; i++) {\n            lines = this.splitLines(layers[i], state.width);\n            layers[i] = this.combineLines(lines, state.offsetX, state.offsetY);\n            console.log(layers[i]);\n        }\n        for (var i = 0; i < layers.length; i++) {\n            if (layers[i] !== this.layers[i]) {\n                this.layers[i] = layers[i];\n                Entities.editEntity(this.boards[i], { text: layers[i] });\n            }\n        }\n    };\n    BoardRenderer.prototype.splitColors = function (state) {\n        var layers = [];\n        var _loop_1 = function (i) {\n            var layer = state.values.replace(/./g, function (match, offset) {\n                var color = state.colors[offset];\n                var layerId = COLOR_TO_LAYER[color] || 0;\n                return layerId === i ? match : ' '; // '\\u2800';\n            });\n            layers.push('\\u200C' + Array(state.width).join(' ') + layer);\n        };\n        for (var i = 0; i < LAYERS_COUNT; i++) {\n            _loop_1(i);\n        }\n        return layers;\n    };\n    BoardRenderer.prototype.splitLines = function (layer, width) {\n        var lines = [];\n        var pos = 0;\n        while (pos < layer.length) {\n            lines.push(layer.substring(pos, pos + width));\n            pos += width;\n        }\n        return lines;\n    };\n    BoardRenderer.prototype.combineLines = function (lines, offsetX, offsetY) {\n        var offset = Array(offsetX + 1).join(' ');\n        for (var i = 0; i < lines.length; i++) {\n            lines[i] = lines[i].replace(/\\s+$/, '');\n            lines[i] = lines[i] ? offset + lines[i] : '';\n        }\n        for (var i = 0; i < offsetY; i++) {\n            lines.splice(1, 0, '');\n        }\n        lines.splice(1, offsetY, '');\n        return lines.join('\\n').replace(/\\n+$/, '');\n    };\n    return BoardRenderer;\n}());\nexports.BoardRenderer = BoardRenderer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CONFIG = exports.MESSAGE_CHANNEL = void 0;\nexports.MESSAGE_CHANNEL = 'eu.ryuu.rescripted';\nexports.CONFIG = typeof Script !== 'undefined'\n    ? Script.require('../config.js') : {};\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ApiBuilder = exports.MAX_ACTIONS_COUNT = void 0;\nexports.MAX_ACTIONS_COUNT = 1024;\nvar ApiBuilder = /** @class */ (function () {\n    function ApiBuilder(level, ticks) {\n        this.level = level;\n        this.ticks = ticks;\n    }\n    ApiBuilder.prototype.createConsole = function () {\n        var self = this;\n        return {\n            log: function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i] = arguments[_i];\n                }\n                self.ticks.push({ logs: __spreadArray([], args, true) });\n            }\n        };\n    };\n    ApiBuilder.prototype.createScript = function (refreshGlobalsFn) {\n        var self = this, globals = {};\n        var playerApi = {\n            move: function (x, y) {\n                var level = self.level;\n                level.move(level.player, x, y);\n                self.tick();\n            }\n        };\n        Object.defineProperty(playerApi, 'x', {\n            get: function () {\n                return self.level.player.x;\n            },\n            set: function (newValue) { },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(playerApi, 'y', {\n            get: function () {\n                return self.level.player.y;\n            },\n            set: function (newValue) { },\n            enumerable: true,\n            configurable: true\n        });\n        var mapApi = {\n            findObject: function (value) {\n                var level = self.level;\n                return level.board.findValue(value);\n            },\n            getValue: function (x, y) {\n                var level = self.level;\n                var index = level.board.getIndex(x, y);\n                return level.board.state.values[index];\n            },\n            getColor: function (x, y) {\n                var level = self.level;\n                var index = level.board.getIndex(x, y);\n                return level.board.state.colors[index];\n            },\n            pathTo: function (x, y) {\n                var level = self.level;\n                var from = level.player;\n                return level.board.findPath(from.x, from.y, x, y, level.items);\n            }\n        };\n        var gunApi = {\n            fire: function (direction) {\n                var level = self.level;\n                var player = level.player;\n                if (!level.energy) {\n                    throw new Error('No energy to fire');\n                }\n                level.energy -= 1;\n                level.shotManager.fire(player.x, player.y, direction);\n                self.tick();\n            }\n        };\n        Object.defineProperty(gunApi, 'energy', {\n            get: function () {\n                return self.level.energy;\n            },\n            set: function (newValue) { },\n            enumerable: true,\n            configurable: true\n        });\n        return {\n            include: function (path) {\n                switch (path) {\n                    case './api/player.js':\n                        globals['player'] = playerApi;\n                        refreshGlobalsFn(globals);\n                        break;\n                    case './api/map.js':\n                        globals['map'] = mapApi;\n                        refreshGlobalsFn(globals);\n                        break;\n                    case './api/gun.js':\n                        globals['gun'] = gunApi;\n                        refreshGlobalsFn(globals);\n                        break;\n                    case './api/level.js':\n                        globals['level'] = self.level;\n                        refreshGlobalsFn(globals);\n                        break;\n                }\n            }\n        };\n    };\n    ApiBuilder.prototype.createEntities = function () {\n        var self = this;\n        return {\n            callEntityServerMethod: function (id, method, params) {\n                var level = self.level;\n                if (level.remotelyCallable.indexOf(method) === -1) {\n                    throw new Error('Server method is not callable');\n                }\n                if (level[method](id, params)) {\n                    self.tick();\n                }\n            }\n        };\n    };\n    ApiBuilder.prototype.tick = function () {\n        var board = this.level.board;\n        this.level.tick();\n        this.ticks.push({ state: board.state });\n        board.state = __assign({}, board.state);\n        if (this.ticks.length >= exports.MAX_ACTIONS_COUNT) {\n            throw new Error('Maximum simulation time reached');\n        }\n    };\n    return ApiBuilder;\n}());\nexports.ApiBuilder = ApiBuilder;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Board = void 0;\nvar Board = /** @class */ (function () {\n    function Board() {\n        this.state = {\n            offsetX: 0,\n            offsetY: 0,\n            values: '',\n            colors: '',\n            width: 0\n        };\n    }\n    Board.fromText = function (boardText, colorMap) {\n        var board = new Board();\n        var lines = boardText.split('\\n');\n        var values = [];\n        var colors = [];\n        var x, y, value, color, width;\n        width = 0;\n        for (y = 0; y < lines.length; y++) {\n            width = Math.max(width, lines[y].length);\n        }\n        for (y = 0; y < lines.length; y++) {\n            for (x = 0; x < lines[y].length; x++) {\n                value = lines[y][x] || ' ';\n                color = colorMap[value] || ' ';\n                values.push(value);\n                colors.push(color);\n            }\n        }\n        board.state.values = values.join('');\n        board.state.colors = colors.join('');\n        board.state.width = width;\n        return board;\n    };\n    Board.prototype.clear = function () {\n        this.state.values = '';\n        this.state.colors = '';\n        this.state.width = 0;\n    };\n    Board.prototype.findValue = function (value) {\n        var width = this.state.width;\n        var index = this.state.values.indexOf(value);\n        if (index === -1 || width === 0) {\n            return;\n        }\n        var x = index % width;\n        var y = Math.floor(index / width);\n        return { x: x, y: y };\n    };\n    Board.prototype.getIndex = function (x, y) {\n        return y * this.state.width + x;\n    };\n    Board.prototype.setValue = function (x, y, value, color) {\n        if (this.state.width === 0) {\n            return;\n        }\n        var index = this.getIndex(x, y);\n        var before, after;\n        if (value !== undefined) {\n            before = this.state.values.substring(0, index);\n            after = this.state.values.substring(index + 1, this.state.values.length);\n            this.state.values = before + value + after;\n        }\n        if (color !== undefined) {\n            before = this.state.colors.substring(0, index);\n            after = this.state.colors.substring(index + 1, this.state.values.length);\n            this.state.colors = before + color + after;\n        }\n    };\n    ;\n    Board.prototype.findPath = function (fromX, fromY, toX, toY, walkable) {\n        var i, index, item, value, canEnter, x, y;\n        if (fromX === toX && fromY === toY) {\n            return;\n        }\n        var queue = [{ x: toX, y: toY }];\n        var matrix = [];\n        var moves = [[0, 1], [0, -1], [1, 0], [-1, 0], [1, 1], [1, -1], [-1, 1], [-1, -1]];\n        var movesLength = moves.length;\n        index = this.getIndex(toX, toY);\n        matrix[index] = true;\n        while (queue.length) {\n            item = queue.shift();\n            for (i = 0; i < movesLength; i++) {\n                x = item.x + moves[i][0];\n                y = item.y + moves[i][1];\n                index = this.getIndex(x, y);\n                value = this.state.values[index];\n                if (x === fromX && y === fromY) {\n                    return { x: item.x - fromX, y: item.y - fromY };\n                }\n                canEnter = value === ' ' || walkable.indexOf(value) !== -1;\n                if (!value || matrix[index] || !canEnter) {\n                    continue;\n                }\n                matrix[index] = true;\n                queue.push({ x: x, y: y });\n            }\n        }\n    };\n    return Board;\n}());\nexports.Board = Board;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Editor = void 0;\nvar Editor = /** @class */ (function () {\n    function Editor() {\n        this.state = {\n            fileName: '',\n            content: ''\n        };\n    }\n    Editor.prototype.applyUpdate = function (action) {\n        var text = this.state.content;\n        if (action.remove) {\n            text = text.substring(0, action.position)\n                + text.substring(action.position + action.remove);\n        }\n        if (action.insert) {\n            text = text.substring(0, action.position)\n                + String(action.insert)\n                + text.substring(action.position);\n        }\n        if (text === this.state.content) {\n            return false;\n        }\n        this.state.content = text;\n        return true;\n    };\n    return Editor;\n}());\nexports.Editor = Editor;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.runInContext = void 0;\nfunction runInContext() {\n    'use strict';\n    var require = undefined;\n    var process = undefined;\n    var Runner = undefined;\n    var ApiBuilder = undefined;\n    var runInContext = undefined;\n    var __dirname = undefined;\n    var __filename = undefined;\n    var player;\n    var map;\n    var gun;\n    var level;\n    var console = this._vm.api.createConsole();\n    var Entities = this._vm.api.createEntities();\n    var Script = (function (context, apiUnlocked) {\n        return context._vm.api.createScript(function (globals) {\n            player = globals['player'];\n            map = globals['map'];\n            gun = globals['gun'];\n            level = apiUnlocked ? globals['level'] : undefined;\n        });\n    }(this, this._vm.apiUnlocked));\n    delete this._vm.apiUnlocked;\n    delete this._vm.api;\n    this._vm.instance = eval('\\'use strict\\';' + String(this._vm.code))();\n    if (this._vm.instance.preload) {\n        this._vm.instance.preload(this._vm.fileName);\n    }\n    if (this._vm.instance.remotelyCallable instanceof Array\n        && this._vm.instance.remotelyCallable.indexOf('run') !== -1) {\n        this._vm.instance.run();\n    }\n}\nexports.runInContext = runInContext;\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Runner = void 0;\nvar api_builder_1 = require(\"./api-builder\");\nvar run_in_context_1 = require(\"./run-in-context\");\nvar Runner = /** @class */ (function () {\n    function Runner() {\n        this.tickCallback = function () { };\n        this.loadTimer = undefined;\n        this.runTimer = undefined;\n        this.status = 'UNLOADED';\n    }\n    Runner.prototype.setTickCallback = function (callback) {\n        this.tickCallback = callback;\n    };\n    Runner.prototype.prepareForExecute = function () {\n        var _this = this;\n        var SCRIPT_LOAD_TIMEOUT = 5000;\n        this.stop();\n        this.setStatus('PENDING');\n        this.loadTimer = Script.setTimeout(function () {\n            _this.setStatus('UNLOADED');\n        }, SCRIPT_LOAD_TIMEOUT);\n    };\n    Runner.prototype.execute = function (simulation) {\n        var ACTION_TIME = 250;\n        if (this.status !== 'PENDING') {\n            return;\n        }\n        this.setStatus('RUNNING');\n        var self = this;\n        function executeAction(ticks) {\n            self.runTimer = Script.setTimeout(function () {\n                var tick;\n                do {\n                    tick = ticks.shift();\n                    self.tickCallback(tick);\n                } while (ticks.length > 0 && !tick.state);\n                if (ticks.length === 0) {\n                    self.setStatus('UNLOADED');\n                    return;\n                }\n                executeAction(ticks);\n            }, ACTION_TIME);\n        }\n        executeAction(simulation);\n    };\n    Runner.prototype.stop = function () {\n        if (this.runTimer) {\n            Script.clearTimeout(this.runTimer);\n            this.runTimer = undefined;\n        }\n        if (this.loadTimer) {\n            Script.clearTimeout(this.loadTimer);\n            this.loadTimer = undefined;\n        }\n        this.setStatus('UNLOADED');\n    };\n    Runner.prototype.simulate = function (level, apiUnlocked) {\n        var ticks = [{ state: level.board.state }];\n        level.board.state = __assign({}, level.board.state);\n        var context = { _vm: {\n                code: level.editor.state.content,\n                fileName: level.editor.state.fileName,\n                apiUnlocked: apiUnlocked,\n                api: new api_builder_1.ApiBuilder(level, ticks)\n            } };\n        try {\n            run_in_context_1.runInContext.call(context);\n        }\n        catch (error) {\n            var maxLineNumber = level.editor.state.content.split('\\n').length;\n            var errorInfo = this.getErrorInfo(error, maxLineNumber);\n            ticks.push({ state: level.board.state, error: errorInfo });\n        }\n        if (level.completed && ticks.length > 0) {\n            ticks[ticks.length - 1].completed = true;\n        }\n        return ticks;\n    };\n    Runner.prototype.getErrorInfo = function (error, maxLineNumber) {\n        var message = error.toString();\n        var line;\n        var col;\n        if (error.stack !== undefined) {\n            var match = error.stack.match(/<anonymous>:(\\d+):(\\d+)/);\n            if (match) {\n                line = parseInt(match[1], 10);\n                col = parseInt(match[2], 10);\n            }\n        }\n        else {\n            var lineNumber = error.lineNumber;\n            if (lineNumber !== undefined && lineNumber <= maxLineNumber) {\n                line = lineNumber;\n                col = 1;\n            }\n        }\n        return { message: message, line: line, col: col };\n    };\n    Runner.prototype.setStatus = function (status) {\n        if (this.status !== status) {\n            this.status = status;\n            this.tickCallback({ status: status });\n        }\n    };\n    return Runner;\n}());\nexports.Runner = Runner;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ServerStore = void 0;\nvar level_00_1 = require(\"../levels/level-00\");\nvar level_01_1 = require(\"../levels/level-01\");\nvar level_02_1 = require(\"../levels/level-02\");\nvar level_03_1 = require(\"../levels/level-03\");\nvar level_04_1 = require(\"../levels/level-04\");\nvar level_05_1 = require(\"../levels/level-05\");\nvar level_06_1 = require(\"../levels/level-06\");\nvar level_07_1 = require(\"../levels/level-07\");\nvar level_08_1 = require(\"../levels/level-08\");\nvar level_09_1 = require(\"../levels/level-09\");\nvar level_10_1 = require(\"../levels/level-10\");\nvar ServerStore = /** @class */ (function () {\n    function ServerStore() {\n    }\n    ServerStore.prototype.resetAll = function () {\n        this.levelNo = 0;\n        this.levels = [this.load(0)];\n        return this.levels[0];\n    };\n    ServerStore.prototype.load = function (levelNo) {\n        switch (levelNo) {\n            case 0:\n                return new level_00_1.Level_00();\n            case 1:\n                return new level_01_1.Level_01();\n            case 2:\n                return new level_02_1.Level_02();\n            case 3:\n                return new level_03_1.Level_03();\n            case 4:\n                return new level_04_1.Level_04();\n            case 5:\n                return new level_05_1.Level_05();\n            case 6:\n                return new level_06_1.Level_06();\n            case 7:\n                return new level_07_1.Level_07();\n            case 8:\n                return new level_08_1.Level_08();\n            case 9:\n                return new level_09_1.Level_09();\n            case 10:\n                return new level_10_1.Level_10();\n        }\n    };\n    ServerStore.prototype.fromLocalStore = function (localStore) {\n        this.levelNo = localStore.levelNo;\n        this.levels = [];\n        for (var i = 0; i < localStore.levels.length; i++) {\n            var newLevel = this.load(i);\n            newLevel.editor.state.content = localStore.levels[i].editor.state.content;\n            newLevel.completed = localStore.levels[i].completed;\n            this.levels.push(newLevel);\n        }\n        return this.levels[this.levelNo];\n    };\n    ServerStore.prototype.toLocalStore = function () {\n        var store = {\n            levelNo: this.levelNo,\n            levels: []\n        };\n        for (var i = 0; i < this.levels.length; i++) {\n            store.levels.push({\n                editor: this.levels[i].editor,\n                completed: this.levels[i].completed\n            });\n        }\n        return store;\n    };\n    ServerStore.prototype.nextLevel = function () {\n        var levelNo = this.levelNo + 1;\n        var level = this.reloadLevel(levelNo);\n        if (!level) {\n            return;\n        }\n        this.levelNo = levelNo;\n        return level;\n    };\n    ServerStore.prototype.prevLevel = function () {\n        var levelNo = this.levelNo - 1;\n        var level = this.reloadLevel(levelNo);\n        if (!level) {\n            return;\n        }\n        this.levelNo = levelNo;\n        return level;\n    };\n    ServerStore.prototype.reloadLevel = function (levelNo) {\n        if (levelNo === undefined) {\n            levelNo = this.levelNo;\n        }\n        var newLevel = this.load(levelNo);\n        if (!newLevel) {\n            return;\n        }\n        // copy editor, keep board\n        if (this.levels[levelNo]) {\n            newLevel.editor = this.levels[levelNo].editor;\n            newLevel.completed = this.levels[levelNo].completed;\n        }\n        this.levels[levelNo] = newLevel;\n        return newLevel;\n    };\n    ServerStore.prototype.resetLevel = function () {\n        var completed = this.levels[this.levelNo].completed;\n        var newLevel = this.load(this.levelNo);\n        newLevel.completed = completed;\n        this.levels[this.levelNo] = newLevel;\n        return newLevel;\n    };\n    ServerStore.prototype.isApiUnlocked = function (level) {\n        if (level instanceof level_09_1.Level_09) {\n            return true;\n        }\n        return this.levels.length >= 11;\n    };\n    return ServerStore;\n}());\nexports.ServerStore = ServerStore;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ShotManager = void 0;\nvar ShotManager = /** @class */ (function () {\n    function ShotManager(board, shotCollisionFn) {\n        this.board = board;\n        this.shotCollisionFn = shotCollisionFn;\n        this.shots = [];\n    }\n    ShotManager.prototype.tick = function () {\n        var i, j, shot, x, y, dx, dy;\n        // Move shots\n        for (var i_1 = 0; i_1 < this.shots.length; i_1++) {\n            shot = this.shots[i_1];\n            var _a = this.shots[i_1], x_1 = _a.x, y_1 = _a.y, dx_1 = _a.dx, dy_1 = _a.dy;\n            var state = this.board.state;\n            var targetIndex = this.board.getIndex(x_1 + dx_1, y_1 + dy_1);\n            var targetValue = this.board.state.values[targetIndex];\n            // no collision\n            if (targetValue === ' ') {\n                if (shot.value) {\n                    this.board.setValue(x_1, y_1, ' ', ' ');\n                }\n                shot.value = dx_1 ? '-' : '|';\n                this.board.setValue(x_1 + dx_1, y_1 + dy_1, shot.value, 'Y');\n                this.shots[i_1].x = x_1 + dx_1;\n                this.shots[i_1].y = y_1 + dy_1;\n                continue;\n            }\n            // collsion, remove shot\n            this.markToRemove(x_1, y_1);\n            if (!this.markToRemove(x_1 + dx_1, y_1 + dy_1) && targetValue) {\n                this.shotCollisionFn(targetValue, x_1 + dx_1, y_1 + dy_1);\n            }\n        }\n        this.removeMarked();\n    };\n    ShotManager.prototype.move = function (position, dx, dy) {\n        var x = position.x;\n        var y = position.y;\n        var i;\n        var sourceIndex = this.board.getIndex(x, y);\n        var sourceValue = this.board.state.values[sourceIndex];\n        if (!sourceValue) {\n            throw new Error('Move outside the board');\n        }\n        if (this.markToRemove(x + dx, y + dy)) {\n            this.shotCollisionFn(sourceValue, x, y);\n        }\n        this.removeMarked();\n    };\n    ShotManager.prototype.fire = function (x, y, direction) {\n        var shot = { x: x, y: y, dx: 0, dy: 0, value: '' };\n        switch (direction) {\n            case 'right':\n                shot.dx = 1;\n                break;\n            case 'left':\n                shot.dx = -1;\n                break;\n            case 'top':\n                shot.dy = -1;\n                break;\n            case 'bottom':\n                shot.dy = 1;\n                break;\n            default:\n                throw new Error('Invalid direction');\n        }\n        this.shots.push(shot);\n    };\n    ShotManager.prototype.markToRemove = function (x, y) {\n        var i, shot, result;\n        result = false;\n        for (i = 0; i < this.shots.length; i++) {\n            shot = this.shots[i];\n            if (shot.x === x && shot.y === y) {\n                if (shot.value) {\n                    this.board.setValue(shot.x, shot.y, ' ', ' ');\n                }\n                shot.deleted = true;\n                result = true;\n            }\n        }\n        return result;\n    };\n    ShotManager.prototype.removeMarked = function () {\n        var i, shot;\n        for (i = this.shots.length - 1; i >= 0; i--) {\n            shot = this.shots[i];\n            if (shot.deleted) {\n                this.shots.splice(i, 1);\n            }\n        }\n    };\n    return ShotManager;\n}());\nexports.ShotManager = ShotManager;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_00 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar CONTENT = \"\\n/*\\n * Rescripted -or- The mission of the Dr Eval.\\n *\\n * Help Dr Eval to complete levels by writing the code that solves\\n * variety of algorithmic problems in JavaScript.\\n *\\n * Your code will be executed with the eval function in your interface app.\\n *\\n * Controls:\\n * - save - saves the game state in your interface app\\n * - run - executes the code (even if not saved),\\n * - reload - restores the game state,\\n * - reset level - reverts all changes in the currently displayed level,\\n * - back/next - navigate through levels\\n *\\n * Good luck hero,\\n * The fate of Dr Eval lies in your hands.\\n */\\n(function () { return this; });\\n\";\nvar BOARD_TEXT = \"\\n\\nPress the Next button to\\n enter the first level. \\n\";\nvar Level_00 = /** @class */ (function (_super) {\n    __extends(Level_00, _super);\n    function Level_00() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT) || this;\n        _this.editor.state.fileName = 'tmp://level-00.js';\n        _this.board.state.offsetX = 4;\n        _this.board.state.offsetY = 2;\n        _this.completed = true;\n        return _this;\n    }\n    return Level_00;\n}(level_base_1.LevelBase));\nexports.Level_00 = Level_00;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_01 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 1 - baby steps\\n\\n  Basically in every level our goal is the same - reach the exit.\\n  Move the player using the following function:\\n\\n  player.move(x, y) -> moves by x, and y squares,\\n                       x and y must be an integer between -1 and 1.\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    // ----- EDIT CODE HERE ------\\n    for (let i = 0; i < 3; i++) {\\n      player.move(0, 1);\\n      player.move(0, -1);\\n    }\\n    // ---------------------------\\n  };\\n\\n  Level.prototype.preload = function(_id) { };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n################\\n# @  #         #\\n#    #    #    #\\n#    #    #    #\\n#         #  X #\\n################\\n\";\nvar Level_01 = /** @class */ (function (_super) {\n    __extends(Level_01, _super);\n    function Level_01() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT) || this;\n        _this.editor.state.fileName = 'tmp://level-01.js';\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        return _this;\n    }\n    return Level_01;\n}(level_base_1.LevelBase));\nexports.Level_01 = Level_01;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_02 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar maze_1 = require(\"../utils/maze\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 2 - path finding\\n\\n  Things are getting complicated. The floor layout seems to change\\n  after each execution.\\n\\n  Fortunately I know the functions, which makes the problem easier:\\n  \\n  Use following API:\\n  - player.x, player.y  -> returns player coordinates,\\n  - map.findObject('X') -> returns absolute position of the given object (x, y),\\n  - map.pathTo(x, y)    -> returns relative position (x, y) to the nearest\\n                           square on the path to given coordinates.\\n                           Or undefined if the destination is not reachable.\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n  Script.include('./api/map.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    var exit, path;\\n\\n    exit = map.findObject('X');\\n\\n    while ((path = map.pathTo(exit.x, exit.y))) {\\n      player.move(path.x, path.y);\\n    }\\n  };\\n\\n  Level.prototype.preload = function(_id) { };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n####################   \\n#k                 #   \\n#                  #   \\n#                  #   \\n#                  ####\\n#                  | X#\\n#                  ####\\n#@                 #   \\n####################   \\n\";\nvar Level_02 = /** @class */ (function (_super) {\n    __extends(Level_02, _super);\n    function Level_02() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT, { '|': 'Y', 'k': 'Y' }) || this;\n        _this.editor.state.fileName = 'tmp://level-02.js';\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.items.push('k');\n        _this.hasKey = false;\n        _this.createMaze();\n        return _this;\n    }\n    Level_02.prototype.createMaze = function () {\n        var _this = this;\n        var maze = new maze_1.Maze(20, 9);\n        maze.create(function (x, y, solid) {\n            if (solid) {\n                var index = _this.board.getIndex(x, y);\n                var value = _this.board.state.values[index];\n                if (value === ' ') {\n                    _this.board.setValue(x, y, '#');\n                }\n            }\n        });\n    };\n    Level_02.prototype.collision = function (source, target, x, y) {\n        _super.prototype.collision.call(this, source, target, x, y);\n        if (source === '@' && target === 'k') {\n            this.hasKey = true;\n        }\n        if (!this.hasKey && source === '@' && target === '|') {\n            throw new Error('Collision with door');\n        }\n    };\n    return Level_02;\n}(level_base_1.LevelBase));\nexports.Level_02 = Level_02;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_03 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar array_utils_1 = require(\"../utils/array-utils\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 3 - map awarness\\n\\n  They know we are after them and activated the security protocols.\\n  We must avoid the lasers. In this level the timing is crusial.\\n\\n  Use following functions:\\n  - map.getValue(x, y) -> returns map value at x, y,\\n  - map.getColor(x, y) -> returns map color at x, y\\n\\n  Hint:\\n  - use player.move(0, 0) -> to wait without moving.\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n  Script.include('./api/map.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    // ----- EDIT CODE HERE ------\\n    var i;\\n    for (i = 0; i < 16; i++) {\\n      player.move(1, 0);\\n    }\\n    // ---------------------------\\n  };\\n\\n  Level.prototype.preload = function(_id) { };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n#####################\\n#                   #\\n#                   #\\n# @               X #\\n#                   #\\n#                   #\\n#####################\\n\";\nvar Level_03 = /** @class */ (function (_super) {\n    __extends(Level_03, _super);\n    function Level_03() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT) || this;\n        _this.editor.state.fileName = 'tmp://level-03.js';\n        _this.lasers = (0, array_utils_1.shuffle)([5, 10, 15]);\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.tickNo += _this.lasers.length;\n        _this.tick();\n        _this.tickNo = Math.floor(Math.random() * 10);\n        return _this;\n    }\n    Level_03.prototype.tick = function () {\n        _super.prototype.tick.call(this);\n        var i, y, index, collision;\n        this.tickNo += 1;\n        collision = false;\n        for (i = 0; i < this.lasers.length; i++) {\n            for (y = 1; y < 6; y++) {\n                index = this.board.getIndex(this.lasers[i], y);\n                if ([2 * i, 2 * i + 1].indexOf(this.tickNo % 6) !== -1) {\n                    if (this.board.state.values[index] === '|') {\n                        this.board.setValue(this.lasers[i], y, ' ', ' ');\n                    }\n                }\n                else {\n                    if (this.board.state.values[index] === '@') {\n                        collision = true;\n                    }\n                    else {\n                        this.board.setValue(this.lasers[i], y, '|', 'R');\n                    }\n                }\n            }\n        }\n        if (collision) {\n            this.collision('@', '|', this.lasers[i], y);\n        }\n    };\n    Level_03.prototype.collision = function (source, target, x, y) {\n        _super.prototype.collision.call(this, source, target, x, y);\n        if (source === '@' && target === '|') {\n            throw new Error('Collision with laser');\n        }\n    };\n    return Level_03;\n}(level_base_1.LevelBase));\nexports.Level_03 = Level_03;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_04 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar array_utils_1 = require(\"../utils/array-utils\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 4 - first contact\\n\\n  Oh no, there is a security drone. It will chase you as soon\\n  as you enter its teritory. Be careful.\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n  Script.include('./api/map.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    // ----- EDIT CODE HERE ------\\n    var i;\\n    for (i = 0; i < 20; i++) {\\n        player.move(0, 0);\\n    }\\n    // ---------------------------\\n  };\\n\\n  Level.prototype.preload = function(_id) { };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n  ############  \\n  #          #  \\n  #  ### ### #  \\n  #  #     # #  \\n###  #     # ###\\n#@            X#\\n###  #     # ###\\n  #  #     # #  \\n  #  ### ### #  \\n  #          #  \\n  ############  \\n\";\nvar Level_04 = /** @class */ (function (_super) {\n    __extends(Level_04, _super);\n    function Level_04() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT) || this;\n        _this.editor.state.fileName = 'tmp://level-04.js';\n        _this.drone = { x: 8, y: 1 + Math.floor(Math.random() * 9) };\n        _this.droneTargets = (0, array_utils_1.shuffle)([{ x: 8, y: 1 }, { x: 8, y: 9 }]);\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.items.push('d');\n        _this.board.setValue(_this.drone.x, _this.drone.y, 'd', 'R');\n        return _this;\n    }\n    Level_04.prototype.tick = function () {\n        _super.prototype.tick.call(this);\n        var player = this.player;\n        var drone = this.drone;\n        var target = this.droneTargets[0];\n        if (player.x <= 2 || player.x >= 12) {\n            if (drone.x === target.x && drone.y === target.y) {\n                this.droneTargets.reverse();\n                target = this.droneTargets[0];\n            }\n        }\n        else {\n            target = player;\n        }\n        var path = this.board.findPath(drone.x, drone.y, target.x, target.y, this.items);\n        if (path !== undefined) {\n            this.move(drone, path.x, path.y);\n        }\n    };\n    Level_04.prototype.collision = function (source, target, x, y) {\n        _super.prototype.collision.call(this, source, target, x, y);\n        if (source === '@' && target === 'd' || source === 'd' && target === '@') {\n            throw new Error('Intercepted by drone');\n        }\n    };\n    return Level_04;\n}(level_base_1.LevelBase));\nexports.Level_04 = Level_04;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_05 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 5 - switches\\n\\n  The security is getting stronger. All switches on the floor must be\\n  turned on, in order to deactivate the laser beam.\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n  Script.include('./api/map.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    // ----- EDIT CODE HERE ------\\n    var i;\\n    for (i = 0; i < 12; i++) {\\n        player.move(1, 0);\\n    }\\n    // ---------------------------\\n  };\\n\\n  Level.prototype.preload = function(_id) { };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n#################\\n#           |   #\\n# @         | X #\\n#           |   #\\n#################\\n\";\nvar Level_05 = /** @class */ (function (_super) {\n    __extends(Level_05, _super);\n    function Level_05() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT, { '|': 'R' }) || this;\n        _this.editor.state.fileName = 'tmp://level-05.js';\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.items.push('+');\n        _this.switches = [];\n        _this.createDominata();\n        return _this;\n    }\n    Level_05.prototype.move = function (position, dx, dy) {\n        var oldX, oldY;\n        if (position) {\n            oldX = position.x;\n            oldY = position.y;\n        }\n        _super.prototype.move.call(this, position, dx, dy);\n        this.redrawSwitch(oldX, oldY);\n    };\n    Level_05.prototype.collision = function (source, target, x, y) {\n        _super.prototype.collision.call(this, source, target, x, y);\n        if (source === '@' && target === '|') {\n            throw new Error('Collision with laser');\n        }\n        if (source === '@' && target === '-') {\n            this.switchItem(x, y, '+');\n        }\n        if (source === '@' && target === '+') {\n            this.switchItem(x, y, '-');\n        }\n    };\n    Level_05.prototype.createDominata = function () {\n        var x, y, r;\n        for (y = 1; y < 4; y++) {\n            for (x = 4; x < 11; x++) {\n                r = Math.floor(Math.random() * 2);\n                switch (r) {\n                    case 0:\n                        this.switches.push({ x: x, y: y, value: '+' });\n                        this.board.setValue(x, y, '+', 'G');\n                        break;\n                    case 1:\n                        this.switches.push({ x: x, y: y, value: '-' });\n                        this.board.setValue(x, y, '-', 'B');\n                        break;\n                }\n            }\n        }\n    };\n    Level_05.prototype.disableLaser = function () {\n        var pos = this.board.findValue('|');\n        while (pos) {\n            this.board.setValue(pos.x, pos.y, ' ');\n            pos = this.board.findValue('|');\n        }\n    };\n    Level_05.prototype.switchItem = function (x, y, value) {\n        var item, allGreen, i;\n        for (i = 0; i < this.switches.length; i++) {\n            item = this.switches[i];\n            if (item.x === x && item.y === y) {\n                item.value = value;\n                item.color = value === '+' ? 'G' : 'B';\n                break;\n            }\n        }\n        for (i = 0; i < this.switches.length; i++) {\n            if (this.switches[i].value === '-') {\n                return;\n            }\n        }\n        this.disableLaser();\n    };\n    Level_05.prototype.redrawSwitch = function (x, y) {\n        var item, i;\n        for (i = 0; i < this.switches.length; i++) {\n            item = this.switches[i];\n            if (item.x === x && item.y === y) {\n                this.board.setValue(item.x, item.y, item.value, item.color);\n                break;\n            }\n        }\n    };\n    return Level_05;\n}(level_base_1.LevelBase));\nexports.Level_05 = Level_05;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_06 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar array_utils_1 = require(\"../utils/array-utils\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 6 - barrier\\n\\n  The way is blocked by a 4 layer barrier. You can open it by entering\\n  the correct code. The code is 4 digit with numbers between 1 and 5.\\n\\n  Each color has assigned a different number. The layer disappears,\\n  if the digit in your code matches the color of the layer.\\n\\n  Each 3-5 ticks, the barrier is renewed.\\n\\n  To submit a code, you need to invoke the server method \\\"submitCode\\\",\\n  while standing next to the panel:\\n\\n  Entities.callEntityServerMethod(this.id, 'submitCode', ['1111']);\\n\\n  Just try not to make too many mistakes...\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n  Script.include('./api/map.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    // ----- EDIT CODE HERE ------\\n    var panel, path;\\n\\n    panel = map.findObject('P');\\n\\n    while ((path = map.pathTo(panel.x, panel.y - 1))) {\\n      player.move(path.x, path.y);\\n    }\\n\\n    Entities.callEntityServerMethod(this.id, 'submitCode', ['1111']);\\n    // ---------------------------\\n  };\\n\\n  Level.prototype.preload = function(_id) {\\n    this.id = _id;\\n  };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n#################\\n#             @ #\\n#               #\\n#               #\\n###P#      ######\\n    #      #     \\n    #      #     \\n    #      #     \\n    #      #     \\n#####      ######\\n#               #\\n# X             #\\n#################\\n\";\nvar Level_06 = /** @class */ (function (_super) {\n    __extends(Level_06, _super);\n    function Level_06() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT, { 'P': 'W' }) || this;\n        _this.editor.state.fileName = 'tmp://level-06.js';\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.items.push('<', '>', 'd');\n        _this.assignment = (0, array_utils_1.shuffle)(['R', 'G', 'B', 'Y', 'W']);\n        _this.ticksToRenew = 0;\n        _this.barrier = [];\n        _this.invalidSubmitted = false;\n        _this.unlocked = false;\n        _this.drone = null;\n        _this.remotelyCallable = ['submitCode'];\n        _this.renewBarrier();\n        return _this;\n    }\n    Level_06.prototype.drawLayer = function (i, enabled) {\n        var value = i % 2 ? '>' : '<';\n        var color = this.barrier[i];\n        for (var x = 5; x < 11; x++) {\n            this.board.setValue(x, i + 5, enabled ? value : ' ', color);\n        }\n    };\n    Level_06.prototype.renewBarrier = function () {\n        var i, x, value, color;\n        if (this.unlocked) {\n            return;\n        }\n        if (this.ticksToRenew) {\n            this.ticksToRenew--;\n            return;\n        }\n        this.ticksToRenew = 3 + Math.floor(Math.random() * 3);\n        for (i = 0; i < 4; i++) {\n            this.barrier[i] = (0, array_utils_1.randomValue)(this.assignment);\n            this.drawLayer(i, true);\n        }\n    };\n    Level_06.prototype.submitCode = function (id, params) {\n        var i, color, invalidCode;\n        if (!params || !(params instanceof Array) || params.length !== 1) {\n            throw new Error('Invalid params');\n        }\n        var code = params[0];\n        if (typeof code !== 'string' || !code.match(/^[1-5]{4}$/)) {\n            throw new Error('Invalid code');\n        }\n        var panel = this.board.findValue('P');\n        if (Math.abs(panel.x - this.player.x) > 1 || Math.abs(panel.y - this.player.y) > 1) {\n            throw new Error('Must stand next to panel' + JSON.stringify([panel, this.player]));\n        }\n        if (this.unlocked) {\n            return;\n        }\n        invalidCode = false;\n        for (i = 0; i < 4; i++) {\n            color = this.assignment[parseInt(code[i], 10) - 1];\n            if (this.barrier[i] === color) {\n                this.drawLayer(i, false);\n            }\n            else {\n                this.drawLayer(i, true);\n                this.invalidSubmitted = true;\n                invalidCode = true;\n            }\n        }\n        if (!invalidCode) {\n            this.unlocked = true;\n        }\n        return true; // make a tick\n    };\n    Level_06.prototype.tick = function () {\n        _super.prototype.tick.call(this);\n        var player = this.player;\n        var drone = this.drone;\n        var droneSpawn = { x: 15, y: 1 };\n        var target = player.y < 7 ? player : droneSpawn;\n        this.renewBarrier();\n        if (!this.invalidSubmitted) {\n            return;\n        }\n        if (!drone) {\n            this.drone = droneSpawn;\n            this.board.setValue(this.drone.x, this.drone.y, 'd', 'R');\n            return;\n        }\n        var path = this.board.findPath(drone.x, drone.y, target.x, target.y, this.items);\n        if (path !== undefined) {\n            this.move(drone, path.x, path.y);\n        }\n    };\n    Level_06.prototype.collision = function (source, target, x, y) {\n        _super.prototype.collision.call(this, source, target, x, y);\n        if (source === '@' && target === '<' || source === '@' && target === '>') {\n            throw new Error('Collision with barrier');\n        }\n        if (source === '@' && target === 'd' || source === 'd' && target === '@') {\n            throw new Error('Intercepted by drone');\n        }\n    };\n    return Level_06;\n}(level_base_1.LevelBase));\nexports.Level_06 = Level_06;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_07 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar array_utils_1 = require(\"../utils/array-utils\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 7 - shooter\\n\\n  You did it! We have broken through the security and now we are in the\\n  protected area.\\n\\n  For now on, you are allowed to use the 'gun' API:\\n  - gun.fire('right')  -> fires a laser beam in given direction.\\n                          Direction can be 'right', 'left', 'top' or 'bottom'.\\n\\n  The gun is powered by the energy. After you pick the yellow 'E', you\\n  will have 3 shots. Then your gun needs to be recharged again.\\n\\n  - gun.energy         -> returns current amount of energy\\n\\n  Show them who they are up against.\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n  Script.include('./api/map.js');\\n  Script.include('./api/gun.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    // ----- EDIT CODE HERE ------\\n    var target, path;\\n\\n    target = map.findObject('E');\\n    while ((path = map.pathTo(target.x, target.y))) {\\n      player.move(path.x, path.y);\\n    }\\n\\n    gun.fire('top');\\n    for (let i = 0; i < 10; i++) {\\n        player.move(0, 0);\\n    }\\n    // ---------------------------\\n  };\\n\\n  Level.prototype.preload = function(_id) {\\n    this.id = _id;\\n  };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n    ##########################\\n#####                    #   #\\n#                        |   #\\n#   #                    | X #\\n#   #                    #   #\\n#   ##########################\\n#   #                         \\n#   #####                     \\n#   @   #                     \\n#       #                     \\n# E E E #                     \\n#########                     \\n\";\nvar Level_07 = /** @class */ (function (_super) {\n    __extends(Level_07, _super);\n    function Level_07() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT, { 'E': 'Y', '|': 'R' }) || this;\n        _this.editor.state.fileName = 'tmp://level-07.js';\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.items.push('E', 'd');\n        _this.drones = [];\n        _this.droneTargets = [];\n        _this.createWalls();\n        _this.createDrones();\n        return _this;\n    }\n    Level_07.prototype.createWalls = function () {\n        var i, x, y;\n        y = [1, 2, 3, 4];\n        for (i = 0; i < 4; i++) {\n            x = 8 + i * 4;\n            (0, array_utils_1.shuffle)(y);\n            this.board.setValue(x, y[0], '#', ' ');\n            this.board.setValue(x, y[1], '#', ' ');\n            this.board.setValue(x, y[2], '#', ' ');\n        }\n    };\n    Level_07.prototype.createDrones = function () {\n        var i, x, y;\n        for (i = 0; i < 5; i++) {\n            x = 6 + i * 4;\n            y = 1 + Math.floor(Math.random() * 3);\n            this.board.setValue(x, y, 'd', 'R');\n            this.drones.push({ x: x, y: y });\n            this.droneTargets.push({ x: x, y: i % 2 ? 1 : 3 });\n        }\n    };\n    Level_07.prototype.disableLaser = function () {\n        var pos = this.board.findValue('|');\n        while (pos) {\n            this.board.setValue(pos.x, pos.y, ' ');\n            pos = this.board.findValue('|');\n        }\n    };\n    Level_07.prototype.tick = function () {\n        _super.prototype.tick.call(this);\n        var i, drone, target, index;\n        var player = this.player;\n        // simulate drones\n        for (i = 0; i < this.drones.length; i++) {\n            drone = this.drones[i];\n            target = this.droneTargets[i];\n            if (drone.x === target.x && drone.y === target.y) {\n                target.y = drone.y === 1 ? 4 : 1;\n            }\n            if (player.x > target.x - 6 && player.y < 6) {\n                target = player;\n            }\n            var path = this.board.findPath(drone.x, drone.y, target.x, target.y, this.items);\n            if (path === undefined) {\n                continue;\n            }\n            index = this.board.getIndex(drone.x + path.x, drone.y + path.y);\n            if (this.board.state.values[index] !== 'd') {\n                this.move(drone, path.x, path.y);\n            }\n        }\n    };\n    Level_07.prototype.collision = function (source, target, x, y) {\n        _super.prototype.collision.call(this, source, target, x, y);\n        if (source === '@' && target === '|') {\n            throw new Error('Collision with laser');\n        }\n        if (source === '@' && target === 'd' || source === 'd' && target === '@') {\n            throw new Error('Intercepted by drone');\n        }\n    };\n    Level_07.prototype.shotCollision = function (target, x, y) {\n        _super.prototype.shotCollision.call(this, target, x, y);\n        var i, drone;\n        if (target === 'd') {\n            for (i = 0; i < this.drones.length; i++) {\n                drone = this.drones[i];\n                if (drone.x === x && drone.y === y) {\n                    this.drones.splice(i, 1);\n                    this.droneTargets.splice(i, 1);\n                    this.board.setValue(drone.x, drone.y, ' ', ' ');\n                    break;\n                }\n            }\n            if (this.drones.length === 0) {\n                this.disableLaser();\n            }\n        }\n    };\n    return Level_07;\n}(level_base_1.LevelBase));\nexports.Level_07 = Level_07;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_08 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 7 - boss\\n\\n  Finally, we're arrived to the CORE. The drones were expecting us, and worse,\\n  they copied my gun's code. We must defeat them with our wits.\\n  Use all the API calls you discovered so far.\\n\\n  If we succeed, we will regain full control of the grid.\\n  I belive in you.\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n  Script.include('./api/map.js');\\n  Script.include('./api/gun.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    // ----- EDIT CODE HERE ------\\n    for (let i = 0; i < 20; i++) {\\n        player.move(0, 0);\\n    }\\n    // ---------------------------\\n  };\\n\\n  Level.prototype.preload = function(_id) {\\n    this.id = _id;\\n  };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n  ###########\\n  #        X#\\n  #    D    #\\n  #=========#\\n  #         #\\n  #         #\\n  #         #\\n  #         #\\n  #         #\\n  #         #\\n######   ####\\n#@          #\\n#E E E   E E#\\n#############\\n\";\nvar Level_08 = /** @class */ (function (_super) {\n    __extends(Level_08, _super);\n    function Level_08() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT, { 'E': 'Y', '=': 'B', 'D': 'R' }) || this;\n        _this.editor.state.fileName = 'tmp://level-08.js';\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.items.push('E', 'd', 'D');\n        _this.drones = [];\n        _this.droneReloads = [];\n        _this.boss = _this.board.findValue('D');\n        _this.bossTarget = { x: 5, y: 2 };\n        _this.bossReload = 0;\n        _this.createDrones();\n        return _this;\n    }\n    Level_08.prototype.createDrones = function () {\n        var i, x, y;\n        for (i = 0; i < 9; i++) {\n            x = 3 + i;\n            y = 4;\n            this.board.setValue(x, y, 'd', 'R');\n            this.drones.push({ x: x, y: y });\n            this.droneReloads.push(Math.floor(Math.random() * 6));\n        }\n    };\n    Level_08.prototype.disableLaser = function () {\n        for (var i = 0; i < 9; i++) {\n            this.board.setValue(3 + i, 3, ' ');\n            this.board.setValue(3 + i, 4, ' ');\n        }\n    };\n    Level_08.prototype.tick = function () {\n        _super.prototype.tick.call(this);\n        var i, boss, target;\n        // Shooting drones\n        for (i = 0; i < this.drones.length; i++) {\n            if (this.droneReloads[i] > 0) {\n                this.droneReloads[i]--;\n                continue;\n            }\n            this.shotManager.fire(this.drones[i].x, this.drones[i].y, 'bottom');\n            this.droneReloads[i] = 3 + Math.floor(Math.random() * 3);\n        }\n        // Boss when drones on the map\n        boss = this.boss;\n        if (!boss) {\n            return;\n        }\n        if (this.drones.length > 0) {\n            target = this.bossTarget;\n            if (boss.x === target.x) {\n                target.x = boss.x === 5 ? 9 : 5;\n            }\n            var path = this.board.findPath(boss.x, boss.y, target.x, target.y, this.items);\n            if (path) {\n                this.move(boss, path.x, path.y);\n            }\n        }\n        else {\n            target = { x: Math.max(3, this.player.x), y: boss.y };\n            var path = this.board.findPath(boss.x, boss.y, target.x, target.y, this.items);\n            if (path) {\n                this.move(boss, path.x, path.y);\n            }\n            if (this.bossReload === 0) {\n                this.bossReload = 10;\n            }\n            else {\n                this.bossReload--;\n                if (boss.x === this.player.x && this.bossReload > 1) {\n                    this.shotManager.fire(boss.x, boss.y, 'bottom');\n                }\n            }\n        }\n    };\n    Level_08.prototype.collision = function (source, target, x, y) {\n        _super.prototype.collision.call(this, source, target, x, y);\n        if (source === '@' && target === '=') {\n            throw new Error('Collision with force field');\n        }\n        if (source === '@' && target === 'd' || source === 'd' && target === '@') {\n            throw new Error('Intercepted by drone');\n        }\n        if (source === '@' && target === 'D' || source === 'D' && target === '@') {\n            throw new Error('Intercepted by drone');\n        }\n    };\n    Level_08.prototype.shotCollision = function (target, x, y) {\n        _super.prototype.shotCollision.call(this, target, x, y);\n        var i, drone;\n        if (target === 'd') {\n            for (i = 0; i < this.drones.length; i++) {\n                drone = this.drones[i];\n                if (drone.x === x && drone.y === y) {\n                    this.drones.splice(i, 1);\n                    this.droneReloads.splice(i, 1);\n                    this.board.setValue(drone.x, drone.y, '=', 'B');\n                    break;\n                }\n            }\n            if (this.drones.length === 0) {\n                this.disableLaser();\n            }\n        }\n        if (target === 'D') {\n            this.board.setValue(this.boss.x, this.boss.y, ' ');\n            this.boss = null;\n        }\n    };\n    return Level_08;\n}(level_base_1.LevelBase));\nexports.Level_08 = Level_08;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_09 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar array_utils_1 = require(\"../utils/array-utils\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 9 - limitless\\n\\n  You were amazing. Now we have full controll over the game state.\\n\\n  Check the new API:\\n  level.board.setValue(x, y, value, color) -> Changes the board squere\\n*/\\n\\n(function () {\\n\\n  Script.include('./api/player.js');\\n  Script.include('./api/map.js');\\n  Script.include('./api/level.js');\\n\\n  function Level() {\\n    this.remotelyCallable = ['run'];\\n  }\\n\\n  Level.prototype.run = function(_id, params) {\\n    // ----- EDIT CODE HERE ------\\n    var drone;\\n\\n    player.move(0, 0);\\n    player.move(0, 0);\\n\\n    level.drones = []; // drones are no more\\n    while (drone = map.findObject('d')) {\\n      level.board.setValue(drone.x, drone.y, ' ');\\n    }\\n\\n    player.move(0, 0);\\n    // ---------------------------\\n  };\\n\\n  Level.prototype.preload = function(_id) {\\n    this.id = _id;\\n  };\\n\\n  return new Level();\\n});\\n\";\nvar BOARD_TEXT = \"\\n ############# \\n##           ##\\n#             #\\n#             #\\n#             #\\n#      @      #\\n#             #\\n#             #\\n#             #\\n##           ##\\n ############# \\n\";\nvar Level_09 = /** @class */ (function (_super) {\n    __extends(Level_09, _super);\n    function Level_09() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT) || this;\n        _this.editor.state.fileName = 'tmp://level-09.js';\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.items.push('d');\n        _this.drones = [];\n        _this.createDrones();\n        return _this;\n    }\n    Level_09.prototype.createDrones = function () {\n        var i, slots = [];\n        for (i = 2; i < 13; i++) {\n            slots.push({ x: i, y: 1 });\n            slots.push({ x: i, y: 9 });\n        }\n        for (i = 2; i < 9; i++) {\n            slots.push({ x: 1, y: i });\n            slots.push({ x: 13, y: i });\n        }\n        (0, array_utils_1.shuffle)(slots);\n        for (i = 0; i < 10; i++) {\n            this.drones.push(slots[i]);\n            this.board.setValue(slots[i].x, slots[i].y, 'd', 'R');\n        }\n    };\n    Level_09.prototype.tick = function () {\n        _super.prototype.tick.call(this);\n        var i, index, drone, target;\n        // Simulate drones\n        for (i = 0; i < this.drones.length; i++) {\n            drone = this.drones[i];\n            target = this.player;\n            var path = this.board.findPath(drone.x, drone.y, target.x, target.y, this.items);\n            if (path === undefined) {\n                continue;\n            }\n            index = this.board.getIndex(drone.x + path.x, drone.y + path.y);\n            if (this.board.state.values[index] !== 'd') {\n                this.move(drone, path.x, path.y);\n            }\n        }\n    };\n    Level_09.prototype.collision = function (source, target, x, y) {\n        _super.prototype.collision.call(this, source, target, x, y);\n        if (source === '@' && target === 'd' || source === 'd' && target === '@') {\n            throw new Error('Intercepted by drone');\n        }\n    };\n    return Level_09;\n}(level_base_1.LevelBase));\nexports.Level_09 = Level_09;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Level_10 = void 0;\nvar level_base_1 = require(\"./level-base\");\nvar CONTENT = \"\\n\\\"use strict\\\";\\n\\n/*\\n  Chapter 9 - the end\\n\\n  Congratulations. Dr Eval escaped, the world is saved, etc.\\n\\n  Hope you liked the game. As the reward, the level API is\\n  now unlocked in all levels.\\n*/\\n(function () { return this; });\\n\";\nvar BOARD_TEXT = \"\\n\\n  The end.\\n\\n\";\nvar Level_10 = /** @class */ (function (_super) {\n    __extends(Level_10, _super);\n    function Level_10() {\n        var _this = _super.call(this, CONTENT, BOARD_TEXT) || this;\n        _this.editor.state.fileName = 'tmp://level-10.js';\n        _this.board.state.offsetX = 2;\n        _this.board.state.offsetY = 2;\n        _this.completed = false;\n        return _this;\n    }\n    return Level_10;\n}(level_base_1.LevelBase));\nexports.Level_10 = Level_10;\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LevelBase = void 0;\nvar board_1 = require(\"../game/board\");\nvar editor_1 = require(\"../game/editor\");\nvar shot_manager_1 = require(\"../game/shot-manager\");\nvar COLOR_MAP = {\n    '@': 'B',\n    'X': 'W'\n};\nvar LevelBase = /** @class */ (function () {\n    function LevelBase(content, boardText, colorMap) {\n        var _this = this;\n        this.remotelyCallable = [];\n        colorMap = __assign(__assign({}, COLOR_MAP), colorMap);\n        this.board = board_1.Board.fromText(boardText, colorMap);\n        this.editor = new editor_1.Editor();\n        this.editor.state.content = content;\n        this.items = ['@', 'X', '-', '|'];\n        this.completed = false;\n        this.player = this.board.findValue('@');\n        this.exit = this.board.findValue('X');\n        this.shotManager = new shot_manager_1.ShotManager(this.board, function (value, x, y) { return _this.shotCollision(value, x, y); });\n        this.energy = 0;\n    }\n    LevelBase.prototype.tick = function () {\n        this.shotManager.tick();\n    };\n    LevelBase.prototype.move = function (position, dx, dy) {\n        if (dx === 0 && dy === 0) {\n            return;\n        }\n        if ([-1, 0, 1].indexOf(dx) === -1 || [-1, 0, 1].indexOf(dy) === -1) {\n            throw new Error('Invalid move (' + dx + ', ' + dy + ')');\n        }\n        if (!position) {\n            throw new Error('Invalid position');\n        }\n        var x = position.x, y = position.y;\n        var state = this.board.state;\n        // handle moving into shots\n        this.shotManager.move(position, dx, dy);\n        var sourceIndex = this.board.getIndex(x, y);\n        var targetIndex = this.board.getIndex(x + dx, y + dy);\n        var sourceColor = this.board.state.colors[sourceIndex];\n        var sourceValue = this.board.state.values[sourceIndex];\n        var targetValue = this.board.state.values[targetIndex];\n        if (!sourceValue || !targetValue) {\n            throw new Error('Move outside the board');\n        }\n        if (targetValue !== ' ' && this.items.indexOf(targetValue) === -1) {\n            throw new Error('Cannot move to a non-empty square');\n        }\n        position.x = x + dx;\n        position.y = y + dy;\n        this.board.setValue(x + dx, y + dy, sourceValue, sourceColor);\n        this.board.setValue(x, y, ' ');\n        if (this.items.indexOf(targetValue) !== -1) {\n            this.collision(sourceValue, targetValue, x + dx, y + dy);\n        }\n    };\n    LevelBase.prototype.collision = function (source, target, x, y) {\n        if (source === '@' && target === 'X') {\n            this.completed = true;\n            throw new Error('Level completed');\n        }\n        if (source === '@' && target === 'E') {\n            this.energy = 3;\n        }\n    };\n    LevelBase.prototype.shotCollision = function (target, x, y) {\n        if (target === '@') {\n            throw new Error('Player hit by laser');\n        }\n    };\n    return LevelBase;\n}());\nexports.LevelBase = LevelBase;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.randomValue = exports.shuffle = void 0;\nfunction shuffle(arr) {\n    var i, r, tmp;\n    for (i = 0; i < arr.length; i++) {\n        r = Math.floor(Math.random() * arr.length);\n        tmp = arr[r];\n        arr[r] = arr[i];\n        arr[i] = tmp;\n    }\n    return arr;\n}\nexports.shuffle = shuffle;\nfunction randomValue(arr) {\n    return arr[Math.floor(Math.random() * arr.length)];\n}\nexports.randomValue = randomValue;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Maze = void 0;\nvar array_utils_1 = require(\"./array-utils\");\n/**\n * @class Recursively divided maze, http://en.wikipedia.org/wiki/Maze_generation_algorithm#Recursive_division_method\n */\nvar Maze = /** @class */ (function () {\n    function Maze(width, height) {\n        this._width = width;\n        this._height = height;\n    }\n    Maze.prototype.create = function (callback) {\n        var w = this._width;\n        var h = this._height;\n        this._map = [];\n        for (var i = 0; i < w; i++) {\n            this._map.push([]);\n            for (var j = 0; j < h; j++) {\n                var border = (i === 0 || j === 0 || i + 1 === w || j + 1 === h);\n                this._map[i].push(border ? 1 : 0);\n            }\n        }\n        this._stack = [\n            [1, 1, w - 2, h - 2]\n        ];\n        this._process();\n        for (var i = 0; i < w; i++) {\n            for (var j = 0; j < h; j++) {\n                callback(i, j, this._map[i][j]);\n            }\n        }\n        this._map = null;\n        return this;\n    };\n    Maze.prototype._process = function () {\n        while (this._stack.length) {\n            var room = this._stack.shift(); /* [left, top, right, bottom] */\n            this._partitionRoom(room);\n        }\n    };\n    Maze.prototype._partitionRoom = function (room) {\n        var availX = [];\n        var availY = [];\n        for (var i = room[0] + 1; i < room[2]; i++) {\n            var top = this._map[i][room[1] - 1];\n            var bottom = this._map[i][room[3] + 1];\n            if (top && bottom && !(i % 2)) {\n                availX.push(i);\n            }\n        }\n        for (var j = room[1] + 1; j < room[3]; j++) {\n            var left = this._map[room[0] - 1][j];\n            var right = this._map[room[2] + 1][j];\n            if (left && right && !(j % 2)) {\n                availY.push(j);\n            }\n        }\n        if (!availX.length || !availY.length) {\n            return;\n        }\n        var x = (0, array_utils_1.randomValue)(availX);\n        var y = (0, array_utils_1.randomValue)(availY);\n        this._map[x][y] = 1;\n        var walls = [];\n        var w = [];\n        walls.push(w); /* left part */\n        for (var i = room[0]; i < x; i++) {\n            this._map[i][y] = 1;\n            w.push([i, y]);\n        }\n        w = [];\n        walls.push(w); /* right part */\n        for (var i = x + 1; i <= room[2]; i++) {\n            this._map[i][y] = 1;\n            w.push([i, y]);\n        }\n        w = [];\n        walls.push(w); /* top part */\n        for (var j = room[1]; j < y; j++) {\n            this._map[x][j] = 1;\n            w.push([x, j]);\n        }\n        w = [];\n        walls.push(w); /* bottom part */\n        for (var j = y + 1; j <= room[3]; j++) {\n            this._map[x][j] = 1;\n            w.push([x, j]);\n        }\n        var solid = (0, array_utils_1.randomValue)(walls);\n        for (var i = 0; i < walls.length; i++) {\n            w = walls[i];\n            if (w === solid) {\n                continue;\n            }\n            var hole = (0, array_utils_1.randomValue)(w);\n            this._map[hole[0]][hole[1]] = 0;\n        }\n        this._stack.push([room[0], room[1], x - 1, y - 1]); /* left top */\n        this._stack.push([x + 1, room[1], room[2], y - 1]); /* right top */\n        this._stack.push([room[0], y + 1, x - 1, room[3]]); /* left bottom */\n        this._stack.push([x + 1, y + 1, room[2], room[3]]); /* right bottom */\n    };\n    return Maze;\n}());\nexports.Maze = Maze;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RescriptedServer = void 0;\nvar board_renderer_1 = require(\"./board-renderer\");\nvar constants_1 = require(\"./constants\");\nvar runner_1 = require(\"./game/runner\");\nvar server_store_1 = require(\"./game/server-store\");\nvar RescriptedServer = /** @class */ (function () {\n    function RescriptedServer() {\n        this.runner = new runner_1.Runner();\n        this.serverStore = new server_store_1.ServerStore();\n        this.level = this.serverStore.resetAll();\n    }\n    RescriptedServer.prototype.preload = function (entityId) {\n        var _this = this;\n        this.entityId = entityId;\n        Script.setTimeout(function () {\n            _this.initLayoutEntities();\n            _this.resetGame(entityId, []);\n            _this.runner.setTickCallback(function (tick) { return _this.handleRunnerTick(tick); });\n        }, constants_1.CONFIG.INIT_ENTITIES_DELAY);\n        this.remotelyCallable = [\n            'resetGame',\n            'resetLevel',\n            'showPreviousLevel',\n            'showNextLevel',\n            'initialize',\n            'update',\n            'saveGameState',\n            'loadGameState',\n            'runScript',\n            'runSimulation',\n            'stopScript'\n        ];\n    };\n    RescriptedServer.prototype.unload = function () { };\n    RescriptedServer.prototype.resetGame = function (_id, params) {\n        this.runner.stop();\n        this.level = this.serverStore.resetAll();\n        var _a = this.level.editor.state, content = _a.content, fileName = _a.fileName;\n        var board = this.level.board;\n        this.sendToAll({ type: 'SET_STATE', content: content, fileName: fileName });\n        this.boardRenderer.render(board.state);\n    };\n    RescriptedServer.prototype.resetLevel = function (_id, params) {\n        this.runner.stop();\n        this.level = this.serverStore.resetLevel();\n        var _a = this.level.editor.state, content = _a.content, fileName = _a.fileName;\n        var board = this.level.board;\n        this.sendToAll({ type: 'SET_STATE', content: content, fileName: fileName });\n        this.boardRenderer.render(board.state);\n    };\n    RescriptedServer.prototype.showPreviousLevel = function (_id, params) {\n        if (this.serverStore.levelNo === 0) {\n            return;\n        }\n        var level = this.serverStore.prevLevel();\n        if (level === undefined) {\n            return;\n        }\n        this.runner.stop();\n        this.level = level;\n        var _a = this.level.editor.state, content = _a.content, fileName = _a.fileName;\n        var board = this.level.board;\n        this.sendToAll({ type: 'SET_STATE', content: content, fileName: fileName });\n        this.boardRenderer.render(board.state);\n    };\n    RescriptedServer.prototype.showNextLevel = function (_id, params) {\n        if (!this.level.completed) {\n            return;\n        }\n        var level = this.serverStore.nextLevel();\n        if (level === undefined) {\n            return;\n        }\n        this.runner.stop();\n        this.level = level;\n        var _a = this.level.editor.state, content = _a.content, fileName = _a.fileName;\n        var board = this.level.board;\n        this.sendToAll({ type: 'SET_STATE', content: content, fileName: fileName });\n        this.boardRenderer.render(board.state);\n    };\n    RescriptedServer.prototype.initialize = function (_id, params) {\n        var clientId = params[0];\n        var status = this.runner.status;\n        var _a = this.level.editor.state, content = _a.content, fileName = _a.fileName;\n        this.sendToClient(clientId, { type: 'SET_STATE', content: content, fileName: fileName, status: status });\n    };\n    RescriptedServer.prototype.update = function (_id, params) {\n        var action;\n        try {\n            action = JSON.parse(params[1]);\n        }\n        catch (e) {\n            return;\n        }\n        if (this.level.editor.applyUpdate(action)) {\n            this.sendToAll(action);\n        }\n    };\n    RescriptedServer.prototype.saveGameState = function (_id, params) {\n        var clientId = params[0];\n        var gameState = this.serverStore.toLocalStore();\n        this.callClient(clientId, 'persistGameState', [JSON.stringify(gameState)]);\n    };\n    RescriptedServer.prototype.loadGameState = function (_id, params) {\n        var clientId = params[0];\n        var gameState;\n        try {\n            gameState = JSON.parse(params[1]);\n        }\n        catch (e) {\n            return;\n        }\n        this.runner.stop();\n        this.level = this.serverStore.fromLocalStore(gameState);\n        var _a = this.level.editor.state, content = _a.content, fileName = _a.fileName;\n        var status = this.runner.status;\n        this.sendToAll({ type: 'SET_STATE', content: content, fileName: fileName, status: status });\n        this.boardRenderer.render(this.level.board.state);\n        this.sendToClient(clientId, { type: 'SHOW_MESSAGE', message: 'Game loaded' });\n    };\n    RescriptedServer.prototype.runScript = function (_id, params) {\n        var clientId = params[0];\n        var apiUnlocked = this.serverStore.isApiUnlocked(this.level);\n        var levelNo = this.serverStore.levelNo;\n        var content = this.level.editor.state.content;\n        this.runner.prepareForExecute();\n        this.callClient(clientId, 'createSimulation', [\n            String(levelNo),\n            content,\n            apiUnlocked ? 'true' : 'false'\n        ]);\n    };\n    RescriptedServer.prototype.runSimulation = function (_id, params) {\n        var simulation;\n        try {\n            simulation = JSON.parse(params[1]);\n        }\n        catch (e) {\n            return;\n        }\n        this.runner.execute(simulation);\n    };\n    RescriptedServer.prototype.stopScript = function (_id, params) {\n        this.runner.stop();\n    };\n    RescriptedServer.prototype.handleRunnerTick = function (tick) {\n        if (tick.logs) {\n            this.sendToAll({ type: 'LOG_INFO', items: tick.logs });\n        }\n        if (tick.error) {\n            var error = tick.error.message;\n            var line = tick.error.line;\n            var col = tick.error.col;\n            this.runner.status = tick.error.message;\n            this.sendToAll({ type: 'LOG_ERROR', error: error, line: line, col: col });\n        }\n        if (tick.status) {\n            this.sendToAll({ type: 'SET_STATUS', status: tick.status });\n        }\n        if (tick.state) {\n            this.level.board.state = tick.state;\n            this.boardRenderer.render(tick.state);\n        }\n        if (tick.completed) {\n            this.level.completed = tick.completed;\n        }\n    };\n    RescriptedServer.prototype.initLayoutEntities = function () {\n        var position = Entities.getEntityProperties(this.entityId, ['position']).position;\n        var entityIds = Entities.findEntities(position, 50);\n        var entities = entityIds.map(function (id) { return Entities.getEntityProperties(id, ['parentID', 'name']); });\n        this.boardRenderer = new board_renderer_1.BoardRenderer(this.entityId, entityIds, entities);\n    };\n    RescriptedServer.prototype.callClient = function (clientId, methodName, params) {\n        if (this.client) {\n            this.client[methodName](this.entityId, params);\n            return;\n        }\n        Entities.callEntityClientMethod(clientId, this.entityId, methodName, params);\n    };\n    ;\n    RescriptedServer.prototype.sendToClient = function (clientId, action) {\n        this.callClient(clientId, 'emitWebEvent', [JSON.stringify(action)]);\n    };\n    RescriptedServer.prototype.sendToAll = function (action) {\n        Messages.sendMessage(constants_1.MESSAGE_CHANNEL, JSON.stringify(action));\n    };\n    return RescriptedServer;\n}());\nexports.RescriptedServer = RescriptedServer;\nexports.default = new RescriptedServer();\n"],"names":[],"sourceRoot":""}